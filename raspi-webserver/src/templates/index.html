<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Dashboard</title>
    
</head>
<style>
    body {
    font-family: Arial, sans-serif;
    color: #405c93;
    background-color: #121212;
    }

    .header {
        text-align: center;
    }
    .dashboard {
        display: flex;
        gap: 20px;
        justify-content: center;
        height: 60vh;
    }

    .boxgreen {
    background-color: #50b566;
    text-align: center;
    width: 60vw;
    height: 60vh;
    border-radius: 10px;
    }

    .boxred {
    background-color: #c53939;
    text-align: center;
    width: 60vw;
    height: 60vh;
    border-radius: 10px;
    }

    .boxgreen h2, .boxred h2 {
        color: white;
        font-size: 1.9vw;
    }
    .counter {
        width: 100%;
        height: 100%;
        color: black;
        font-style: bold;
        font-size: 8vw;
    }
    
    .buttondiv{
        text-align: center;
        padding-top: 2.5%;
    }
    .threshold{
        text-align: center;
        padding-top: 0.5%;
    }
    .buttonblue {
        align-self: center;
        background-color: #405c93;
        color: white;
        padding: 10px 20px;
        border: white;
        border-radius: 2px;
        transition: background-color 0.3s;
        font-size: 2vw;
    }
    .buttonblue.spaceright{
        margin-right: 10%;
    }
    .buttonblue.spaceleft{
        margin-left: 10%;
    }
    .buttonblue:active {
    background-color: #2e456e; /* Darker shade of blue for click effect */
    }

    .buttonred {
        align-self: center;
        background-color: #c53939;
        color: white;
        padding: 10px 20px;
        border: white;
        border-radius: 2px;
        transition: background-color 0.3s;
        font-size: 2vw;

    }

    .buttonred:active {
    background-color: #a52e06; 
    }
</style>

<body>
    <h1 class="header">Wareneinang-Sortierung</h1>
    <div class="dashboard">
        <div class="boxgreen" id="divbox1">
            <h2 id="thesholdlt">&lt;250 gram</h2>
            <p class="counter" id="box1">0</p>
        </div>
        <div class="boxgreen" id="divbox2">
            <h2 id = "thresholdgt">&gt;250 gram</h2>
            <p class="counter" id="box2">77</p>
        </div>
    </div>
    <div class="buttondiv">
        <button onclick="emptiedbox1()" class="buttonblue spaceright" id ="empty1">Click when emptied</button>
        <button onclick="startOrPause()" class="buttonblue" id="button" disabled>Pickup</button>
        <button onclick="emptiedbox2()" class="buttonblue spaceleft" id ="empty2">Click when emptied</button>
    </div>
    <div class="threshold">
        <input type="text" id="messageInput" placeholder="Enter Threshold">
    </div>
    <div class="threshold">
        <button onclick="sendThreshold()" class="buttonblue">Change Threshold</button>
    </div>
    
    
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io();
        var button = document.getElementById('button');
        button.disabled = false;
        let box1counter = 0; //function to get current value of box1
        let box2counter = 0;
        socket.on('connect', () => {
            console.log('Connected to WebSocket server');
            socket.emit('get_counter_value'); //Set current counter
            socket.emit('get_threshold');
        });

        socket.on('message_from_server', (data) => {
            console.log('Received message from server:', data);
        });

        function emptiedbox1() {
            socket.emit('empty_box1');
        }

        function emptiedbox2() {
            socket.emit('empty_box2');
        }

        function incrementBox1() {
            var element = document.getElementById("box1");
            var currentValue = parseInt(element.innerText);
            box1counter++;
            element.innerText = box1counter;
        }

        function incrementBox2() {
            var element = document.getElementById("box2");
            var currentValue = parseInt(element.innerText);
            element.innerText = currentValue + 1;
        }

        socket.on('box1_full', () => {
            //change to red
            document.getElementById("divbox1").className = "boxred";
            document.getElementById("box1").innerText = "Full Box 1";
            document.getElementById('button').innerText = 'Wait Till Box is Empty';
            document.getElementById('button').disabled = true;
            document.getElementById('button').className = 'buttonred';
        });

        socket.on('box2_full', () => {
            //change to red
            document.getElementById("divbox2").className = "boxred";
            document.getElementById("box2").innerText = "Full Box 2";
            document.getElementById('button').innerText = 'Wait Till Box is Empty';
            document.getElementById('button').disabled = true;
            document.getElementById('button').className = 'buttonred';
        });

        socket.on('box1_empty', (data) => {
            //change to green
            document.getElementById("divbox1").className = "boxgreen";
            document.getElementById("box1").innerText = data.value;
        });

        socket.on('box2_empty', (data) => {
            //change to green
            document.getElementById("divbox2").className = "boxgreen";
            document.getElementById("box2").innerText = data.value;
        });

        function changeColorToRed(box){
            //change the class of div
            if(box == 1){
                document.getElementById("divbox1").className = "boxred";
                document.getElementById("box1").innerText = "Full Box 1";
            }
            if(box == 2){
                document.getElementById("divbox2").className = "boxred";
                document.getElementById("box2").innerText = "Full Box 2";
            }
            
        }

        function changeColorToGreen(){
            //change the class of div
                document.getElementById("divbox1").className = "boxgreen";
                document.getElementById("box1").innerText = box1counter;
                document.getElementById('button').disabled = false;
                document.getElementById('button').innerText = 'Pickup';
                document.getElementById('button').className = 'buttonblue';
        }

        function changeColorToGreen2(){
            //change the class of div
                document.getElementById("divbox2").className = "boxgreen";
                document.getElementById("box2").innerText = box1counter;
                document.getElementById('button').disabled = false;
            document.getElementById('button').innerText = 'Pickup';
            document.getElementById('button').className = 'buttonblue';
        }

        socket.on('update_counter2', (value) => {
            incrementBox2();
        });

        socket.on('update_counter1', (value) => {
            incrementBox1();
        });

        socket.on('set_counter1', (data) => {
            box1counter = data.value;
            document.getElementById("box1").innerText = box1counter;
        });

        socket.on('set_counter2', (data) => {
            box2counter = data.value;
            document.getElementById("box2").innerText = box2counter;
        });

        function getCounterValue(){
            socket.emit('get_counter_value');
        }
        function startOrPause() {
            if(document.getElementById('button').className === 'buttonred'){
                document.getElementById('button').innerText = 'Running';
                document.getElementById('button').className = 'buttonblue';}
            else{
                document.getElementById('button').innerText = 'Wait For Robot';
                document.getElementById('button').disabled = true;
                document.getElementById('button').className = 'buttonred';
            }
            socket.emit('start/pause');
        }

        socket.on('enable_button', () => {
            document.getElementById('button').disabled = false;
            document.getElementById('button').innerText = 'Pickup';
            document.getElementById('button').className = 'buttonblue';
        });

        function sendThreshold() {
            const message = document.getElementById('messageInput').value;
            const theshold = parseInt(message);
            if(message === '' || isNaN(theshold)) {
                alert('Please enter a valid number');
                return;
            }
            else if (theshold < 0 || theshold > 500) {
                alert('Please enter a number between 0 and 500');
                return;
            }
            else {
                document.getElementById('thresholdgt').innerText = `>${theshold} gram`;
                document.getElementById('thesholdlt').innerText = `<=${theshold} gram`;
                socket.emit('threshold', { theshold });
            }
        }
    </script>
</body>
</html>
